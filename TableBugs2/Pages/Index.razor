@using BootstrapBlazor.Components;
@using System.Diagnostics.CodeAnalysis;
@page "/"

<PageTitle>Index</PageTitle>

<h1>Virtual Scroll + Filterable = BOOM?</h1>
<i> How to correct deal with OnQueryAsync? </i>
@code
{
    private IReadOnlyCollection<DataItem>? _items;

    protected override void OnInitialized()
    {
        base.OnInitialized();
        _items = Enumerable.Range(0, 500).Select(p => new DataItem { Text = $"#{p}" }).ToArray();
    }

    class DataItem
    {
        public string? Text { get; set; }
    }

    private Task<QueryData<DataItem>> DoQuery(QueryPageOptions options) => Task.FromResult(
        new QueryData<DataItem>
        {
            Items = _items!.Where(options.Filters.GetFilterFunc<DataItem>()).Skip(options.StartIndex).Take(options.PageItems).ToList(),
            TotalCount = _items!.Count
        }
    );
}

<div style="height: 500px">
    <Table TItem="DataItem" OnQueryAsync="DoQuery" ShowLineNo LineNoText="#" IsBordered IsFixedHeader ScrollMode="ScrollMode.Virtual">
         <TableColumns>
             <TableColumn Text="Text" @bind-Field="@context.Text" Filterable></TableColumn>
         </TableColumns>
     </Table>
 </div>

